// Форматирует номер телефона в единый формат
Функция ФорматироватьТелефон(Знач НомерТелефона) Экспорт
    
    Если НомерТелефона = Неопределено Или НомерТелефона = "" Тогда
        Возврат "";
    КонецЕсли;
    
    // Удаляем все нецифровые символы
    ЧистыйНомер = СтрЗаменить(НомерТелефона, "+", "");
    ЧистыйНомер = СтрЗаменить(ЧистыйНомер, "(", "");
    ЧистыйНомер = СтрЗаменить(ЧистыйНомер, ")", "");
    ЧистыйНомер = СтрЗаменить(ЧистыйНомер, "-", "");
    ЧистыйНомер = СтрЗаменить(ЧистыйНомер, " ", "");
    
    // Форматируем в +7 (XXX) XXX-XX-XX
    Если СтрДлина(ЧистыйНомер) = 11 И Лев(ЧистыйНомер, 1) = "7" Тогда
        Возврат "+7 (" + Сред(ЧистыйНомер, 2, 3) + ") " + Сред(ЧистыйНомер, 5, 3) + "-" + Сред(ЧистыйНомер, 8, 2) + "-" + Сред(ЧистыйНомер, 10, 2);
    ИначеЕсли СтрДлина(ЧистыйНомер) = 10 Тогда
        Возврат "+7 (" + Лев(ЧистыйНомер, 3) + ") " + Сред(ЧистыйНомер, 4, 3) + "-" + Сред(ЧистыйНомер, 7, 2) + "-" + Сред(ЧистыйНомер, 9, 2);
    Иначе
        Возврат НомерТелефона;
    КонецЕсли;
    
КонецФункции

// Проверяет валидность email адреса
Функция ПроверитьEmail(Знач Email) Экспорт
    
    Если Email = Неопределено Или Email = "" Тогда
        Возврат Ложь;
    КонецЕсли;
    
    // Простая проверка на наличие @ и точки
    ПозицияСобаки = Найти(Email, "@");
    Если ПозицияСобаки = 0 Тогда
        Возврат Ложь;
    КонецЕсли;
    
    // Проверяем что есть доменная часть
    ДоменнаяЧасть = Сред(Email, ПозицияСобаки + 1);
    Если Найти(ДоменнаяЧасть, ".") = 0 Тогда
        Возврат Ложь;
    КонецЕсли;
    
    Возврат Истина;
    
КонецФункции

// Сокращает ФИО в формат "Иванов И.И."
Функция СократитьФИО(Знач ПолноеФИО) Экспорт
    
    Если ПолноеФИО = Неопределено Или ПолноеФИО = "" Тогда
        Возврат "";
    КонецЕсли;
    
    ЧастиФИО = СтрРазделить(ПолноеФИО, " ", Ложь);
    Если ЧастиФИО.Количество() < 2 Тогда
        Возврат ПолноеФИО;
    КонецЕсли;
    
    Фамилия = ЧастиФИО[0];
    Имя = Лев(ЧастиФИО[1], 1) + ".";
    
    Если ЧастиФИО.Количество() >= 3 Тогда
        Отчество = Лев(ЧастиФИО[2], 1) + ".";
        Возврат Фамилия + " " + Имя + Отчество;
    Иначе
        Возврат Фамилия + " " + Имя;
    КонецЕсли;
    
КонецФункции

// Тестируем наши функции
Процедура Тестирование() Экспорт
    
    Сообщить("=== Тестирование StringUtils ===");
    
    // Тест телефонов
    Телефоны = Новый Массив;
    Телефоны.Добавить("+7 (999) 123-45-67");
    Телефоны.Добавить("89991234567");
    Телефоны.Добавить("9991234567");
    
    Для Каждого Телефон Из Телефоны Цикл
        Результат = ФорматироватьТелефон(Телефон);
        Сообщить(Телефон + " -> " + Результат);
    КонецЦикла;
    
    // Тест email
    Сообщить("");
    Сообщить("Проверка email:");
    Сообщить("test@example.com: " + ПроверитьEmail("test@example.com"));
    Сообщить("invalid-email: " + ПроверитьEmail("invalid-email"));
    
    // Тест ФИО
    Сообщить("");
    Сообщить("Сокращение ФИО:");
    Сообщить("Иванов Петр Сидорович -> " + СократитьФИО("Иванов Петр Сидорович"));
    Сообщить("Петрова Мария -> " + СократитьФИО("Петрова Мария"));
    
КонецПроцедуры

Тестирование();